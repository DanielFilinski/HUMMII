–î–∞–≤–∞–π—Ç–µ –∏–∑—É—á—É —Ç–µ–∫—É—â—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞, —á—Ç–æ–±—ã –¥–∞—Ç—å –≤–∞–º –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º –≤—Å–µ—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ö–∞–Ω–∞–¥—ã.

[5 tools called]

–û—Ç–ª–∏—á–Ω–æ! –ò–∑—É—á–∏–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø—Ä–æ–µ–∫—Ç–∞ Hummii, –º–æ–≥—É –¥–∞—Ç—å –≤–∞–º –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–∏—Å—Ç–µ–º–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ —Å —É—á–µ—Ç–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∫–∞–Ω–∞–¥—Å–∫–æ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞.

## üó∫Ô∏è –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è Hummii

### **1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

–†–µ–∫–æ–º–µ–Ω–¥—É—é **–º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –ø–æ–¥—Ö–æ–¥** —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏:

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –†—É—á–Ω–æ–π –≤–≤–æ–¥ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)**
- –ì–æ—Ä–æ–¥/–ø—Ä–æ–≤–∏–Ω—Ü–∏—è - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- –ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
- –≠—Ç–æ –±–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –Ω–µ –¥–∞—Å—Ç –¥–æ—Å—Ç—É–ø –∫ GPS

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: Geolocation API (—Å —Å–æ–≥–ª–∞—Å–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)**
- –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –Ω–∞ –∫–∞—Ä—Ç—É –ø–æ–∏—Å–∫–∞
- –ü–æ–≤—ã—à–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- **–í–∞–∂–Ω–æ**: —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ explicit consent (PIPEDA —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: IP-–≥–µ–æ–ª–æ–∫–∞—Ü–∏—è (fallback, —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥/–ø—Ä–æ–≤–∏–Ω—Ü–∏—è)**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–ù–µ —Ö—Ä–∞–Ω–∏—Ç—å IP-–∞–¥—Ä–µ—Å–∞** –±–µ–∑ consent
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è: "–ü–æ—Ö–æ–∂–µ, –≤—ã –∏–∑ –¢–æ—Ä–æ–Ω—Ç–æ?"

### **2. –ü–æ–∫–∞–∑ –ª–æ–∫–∞—Ü–∏–∏ - –ø—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö**

**–î–ª—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π (–ø—É–±–ª–∏—á–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å):**
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: **–†–∞–π–æ–Ω/–≥–æ—Ä–æ–¥** (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Downtown Toronto" –∏–ª–∏ "Mississauga")
- **–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å** –Ω–∏–∫–æ–≥–¥–∞
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ:
  ```
  ‚ñ° –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –º–æ–π –≥–æ—Ä–æ–¥ (Toronto)
  ‚ñ° –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–π–æ–Ω (Downtown, Etobicoke)
  ‚ñ° –°–∫—Ä—ã—Ç—å –ª–æ–∫–∞—Ü–∏—é (—Ç–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω-—É—Å–ª—É–≥–∏)
  ```

**–î–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤:**
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞: –≤—ã–±–æ—Ä —Ä–∞–π–æ–Ω–∞ –∏–ª–∏ –ø–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å (–ø–µ—Ä–≤—ã–µ 3 —Å–∏–º–≤–æ–ª–∞)
- –¢–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è –æ—Ç–∫–ª–∏–∫–∞ (–≤ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º —á–∞—Ç–µ)

**–î–ª—è –∫–∞—Ä—Ç—ã:**
- –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ –º–∞—Ä–∫–µ—Ä—ã –≤ —Ä–∞–¥–∏—É—Å–µ ~500–º –æ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ (fuzzy location)
- –¢–æ—á–Ω–∞—è –ª–æ–∫–∞—Ü–∏—è —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–∞–∫—Ç–∞

### **3. –§–∏–ª—å—Ç—Ä "–†–∞–¥–∏—É—Å –ø–æ–∏—Å–∫–∞"**

```typescript
// –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –æ–ø—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–∞
const radiusOptions = [
  { label: "–í –ø—Ä–µ–¥–µ–ª–∞—Ö 5 –∫–º", value: 5 },
  { label: "–í –ø—Ä–µ–¥–µ–ª–∞—Ö 10 –∫–º", value: 10 },
  { label: "–í –ø—Ä–µ–¥–µ–ª–∞—Ö 25 –∫–º", value: 25 },
  { label: "–í–µ—Å—å –≥–æ—Ä–æ–¥", value: 50 },
  { label: "–í—Å—è –ø—Ä–æ–≤–∏–Ω—Ü–∏—è", value: null },
  { label: "–û–Ω–ª–∞–π–Ω-—É—Å–ª—É–≥–∏", value: "remote" }
];
```

**–õ–æ–≥–∏–∫–∞:**
- –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10 –∫–º (–¥–ª—è –≥–æ—Ä–æ–¥—Å–∫–∏—Ö —Ä–∞–π–æ–Ω–æ–≤)
- –î–ª—è —Å–µ–ª—å—Å–∫–æ–π –º–µ—Å—Ç–Ω–æ—Å—Ç–∏: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å –¥–æ 50 –∫–º
- –î–ª—è –æ–Ω–ª–∞–π–Ω-—É—Å–ª—É–≥: —Ä–∞–¥–∏—É—Å –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

### **4. –û–Ω–ª–∞–π–Ω-—É—Å–ª—É–≥–∏ (remote services)**

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**
- –û—Ç–¥–µ–ª—å–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è/—Ñ–∏–ª—å—Ç—Ä "–û–Ω–ª–∞–π–Ω-—É—Å–ª—É–≥–∏"
- –ü—Ä–∏–º–µ—Ä—ã: –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–∏–∑–∞–π–Ω, –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏, –æ–±—É—á–µ–Ω–∏–µ, –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
- –£ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö:
  ```
  –¢–∏–ø —É—Å–ª—É–≥:
  ‚òë –õ–æ–∫–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ)
  ‚òë –û–Ω–ª–∞–π–Ω-—É—Å–ª—É–≥–∏ (—É–¥–∞–ª—ë–Ω–Ω–æ)
  ```

### **5. –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª –≤ –¥–æ—Å—Ç—É–ø–µ –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏**

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è PIPEDA compliance!**

#### **–°—Ü–µ–Ω–∞—Ä–∏–π A: –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –æ—Ç–∫–∞–∑–∞–ª –≤ –¥–æ—Å—Ç—É–ø–µ**
```typescript
// Fallback chain
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ä–æ–¥ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
2. –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: 
   "–î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –∫–∞—Ä—Ç–µ —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ª–æ–∫–∞—Ü–∏–∏ –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ —Ä–∞–π–æ–Ω –≤—Ä—É—á–Ω—É—é"
3. –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Ä—É—á–Ω–æ–π –≤—ã–±–æ—Ä —Ä–∞–π–æ–Ω–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
4. –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ë–ï–ó –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏, –µ—Å–ª–∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ–Ω–ª–∞–π–Ω-—É—Å–ª—É–≥–∏
```

#### **–°—Ü–µ–Ω–∞—Ä–∏–π B: –ö–ª–∏–µ–Ω—Ç –æ—Ç–∫–∞–∑–∞–ª –≤ –¥–æ—Å—Ç—É–ø–µ**
```typescript
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ä–æ–¥ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è
2. –ü–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç—É —Å —Ü–µ–Ω—Ç—Ä–æ–º –Ω–∞ –≥–æ—Ä–æ–¥–µ
3. –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤–≤–µ—Å—Ç–∏ –ø–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å –∏–ª–∏ –≤—ã–±—Ä–∞—Ç—å —Ä–∞–π–æ–Ω –≤—Ä—É—á–Ω—É—é
4. –§–∏–ª—å—Ç—Ä —Ä–∞–¥–∏—É—Å–∞ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ "–í–µ—Å—å –≥–æ—Ä–æ–¥" –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
5. –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –∏—Å–∫–∞—Ç—å –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –ë–ï–ó –∫–∞—Ä—Ç—ã
```

#### **–í–∞–∂–Ω–æ: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª!**
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å **–ø–æ–ª–Ω–æ—Å—Ç—å—é –±–µ–∑ GPS**
- GPS - —ç—Ç–æ enhancement, –∞ –Ω–µ requirement

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ Location System

```markdown
## Location System

### 1. Location Detection Methods
‚îú‚îÄ **Manual Input** (primary, required at registration)
‚îÇ  ‚îú‚îÄ City/Province (mandatory)
‚îÇ  ‚îú‚îÄ Postal Code (optional)
‚îÇ  ‚îî‚îÄ Neighborhood/District (optional)
‚îÇ
‚îú‚îÄ **Geolocation API** (optional, with explicit consent)
‚îÇ  ‚îú‚îÄ Request on first map access
‚îÇ  ‚îú‚îÄ Show clear consent dialog
‚îÇ  ‚îú‚îÄ Store preference in localStorage
‚îÇ  ‚îî‚îÄ Allow to revoke anytime in settings
‚îÇ
‚îî‚îÄ **IP Geolocation** (fallback only)
   ‚îú‚îÄ Use only to suggest city
   ‚îú‚îÄ Never store IP addresses
   ‚îî‚îÄ Use service: ipapi.co or GeoJS

### 2. Map Integration
‚îú‚îÄ **Google Maps API** (recommended for Canada)
‚îÇ  ‚îú‚îÄ Geocoding API - convert addresses to coordinates
‚îÇ  ‚îú‚îÄ Places API - autocomplete for addresses
‚îÇ  ‚îú‚îÄ Distance Matrix API - calculate distances
‚îÇ  ‚îî‚îÄ Maps JavaScript API - display map
‚îÇ
‚îú‚îÄ **Alternative: Mapbox** (cost-effective for high traffic)
‚îÇ  ‚îú‚îÄ Better pricing for large scale
‚îÇ  ‚îî‚îÄ More customizable UI
‚îÇ
‚îî‚îÄ **Map Features**
   ‚îú‚îÄ Clustered markers for contractors
   ‚îú‚îÄ Fuzzy location (¬±500m radius)
   ‚îú‚îÄ Filter by category on map
   ‚îî‚îÄ Click marker ‚Üí open contractor profile

### 3. Search Radius Filter
‚îú‚îÄ Within 5 km
‚îú‚îÄ Within 10 km (default for urban)
‚îú‚îÄ Within 25 km
‚îú‚îÄ Entire city (~50 km)
‚îú‚îÄ Entire province
‚îî‚îÄ Remote/Online services only

### 4. Online Services Category
‚îú‚îÄ Service types: Design, Consulting, Tutoring, Programming
‚îú‚îÄ No location requirement
‚îú‚îÄ Filter: "Remote Only" checkbox
‚îî‚îÄ Contractor setting: "I offer online services"

### 5. Privacy & Location Visibility Settings
‚îú‚îÄ Contractor settings:
‚îÇ  ‚îú‚îÄ [ ] Show on map (default: ON)
‚îÇ  ‚îú‚îÄ [ ] Show city (default: ON)
‚îÇ  ‚îú‚îÄ [ ] Show neighborhood (default: ON)
‚îÇ  ‚îî‚îÄ [ ] Hide location (online services only)
‚îÇ
‚îú‚îÄ Client settings:
‚îÇ  ‚îú‚îÄ Share location with contractors (after accepting bid)
‚îÇ  ‚îî‚îÄ Show approximate location in order (postal code first 3 digits)
‚îÇ
‚îî‚îÄ Privacy rules:
   ‚îú‚îÄ NEVER show exact address publicly
   ‚îú‚îÄ Share precise location only in private chat
   ‚îî‚îÄ Allow location data deletion (PIPEDA Right to Erasure)

### 6. Geolocation Consent Flow

#### For Contractors:
1. During registration ‚Üí select city (mandatory)
2. On first profile edit ‚Üí prompt: "Show on map? Allow location access?"
3. If denied ‚Üí fallback to city/neighborhood dropdown
4. Settings ‚Üí toggle "Show on map" anytime

#### For Clients:
1. During registration ‚Üí select city (mandatory)
2. On first search/map view ‚Üí prompt: "Find nearby contractors? Allow location?"
3. If denied ‚Üí fallback to city-wide search
4. Can search by category without map

#### Consent Dialog (PIPEDA compliant):
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Allow Location Access?                     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  We use your location to show nearby        ‚îÇ
‚îÇ  contractors and relevant services.         ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  ‚Ä¢ Your exact address is never shared       ‚îÇ
‚îÇ  ‚Ä¢ You can change this anytime in Settings  ‚îÇ
‚îÇ  ‚Ä¢ This is optional - you can search        ‚îÇ
‚îÇ    by city instead                          ‚îÇ
‚îÇ                                             ‚îÇ
‚îÇ  [Learn More]  [Not Now]  [Allow]          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 7. Technical Implementation

#### Backend (NestJS):
```typescript
// location.entity.ts
@Entity()
export class Location {
  @Column({ nullable: false })
  city: string;

  @Column({ nullable: false })
  province: string;

  @Column({ nullable: true })
  postalCode: string; // Store only first 3 chars (FSA)

  @Column({ nullable: true })
  neighborhood: string;

  // Fuzzy coordinates (not exact)
  @Column({ type: 'decimal', precision: 10, scale: 7, nullable: true })
  latitude: number; // ¬±0.005 random offset

  @Column({ type: 'decimal', precision: 10, scale: 7, nullable: true })
  longitude: number; // ¬±0.005 random offset

  @Column({ default: true })
  showOnMap: boolean;

  @Column({ default: false })
  offersOnlineServices: boolean;
}

// location.service.ts
@Injectable()
export class LocationService {
  // Search contractors within radius
  async findContractorsNearby(
    latitude: number,
    longitude: number,
    radiusKm: number,
    categoryId?: string
  ) {
    // Use PostGIS or raw SQL with Haversine formula
    const query = `
      SELECT *, 
        ( 6371 * acos( cos( radians(${latitude}) ) 
        * cos( radians( latitude ) ) 
        * cos( radians( longitude ) - radians(${longitude}) ) 
        + sin( radians(${latitude}) ) 
        * sin( radians( latitude ) ) 
        ) ) AS distance
      FROM contractors
      WHERE show_on_map = true
      HAVING distance < ${radiusKm}
      ORDER BY distance;
    `;
  }

  // Add fuzzy offset to protect privacy
  fuzzyLocation(lat: number, lng: number): { lat: number; lng: number } {
    const offset = 0.005; // ~500m
    return {
      lat: lat + (Math.random() - 0.5) * offset,
      lng: lng + (Math.random() - 0.5) * offset,
    };
  }
}
```

#### Frontend (Next.js):
```typescript
// hooks/useGeolocation.ts
export function useGeolocation() {
  const [location, setLocation] = useState<GeolocationPosition | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [hasConsent, setHasConsent] = useState<boolean | null>(null);

  useEffect(() => {
    // Check if user previously gave consent
    const consent = localStorage.getItem('geo_consent');
    setHasConsent(consent === 'granted');
  }, []);

  const requestLocation = async () => {
    if (!navigator.geolocation) {
      setError('Geolocation not supported');
      return;
    }

    // Show consent dialog first
    const userConsent = await showConsentDialog();
    
    if (!userConsent) {
      localStorage.setItem('geo_consent', 'denied');
      setHasConsent(false);
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (position) => {
        setLocation(position);
        localStorage.setItem('geo_consent', 'granted');
        setHasConsent(true);
      },
      (err) => {
        setError(err.message);
        // Fallback to IP geolocation or manual input
      }
    );
  };

  return { location, error, hasConsent, requestLocation };
}
```

### 8. Data Storage & Retention (PIPEDA)
‚îú‚îÄ Store only necessary location data
‚îú‚îÄ Fuzzy coordinates (not exact GPS)
‚îú‚îÄ Postal code: only FSA (first 3 chars)
‚îú‚îÄ Allow user to delete location data
‚îú‚îÄ Don't log IP addresses without consent
‚îî‚îÄ Retention: delete on account deletion
```

---

## üéØ –ú–æ–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è Hummii:

### **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Google Maps API**
- –õ—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–Ω–∞–¥—Å–∫–∏—Ö –∞–¥—Ä–µ—Å–æ–≤
- –û—Ç–ª–∏—á–Ω—ã–π –∞–≤—Ç–æ–∫–æ–º–ø–ª–∏—Ç –¥–ª—è –∞–¥—Ä–µ—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å

### **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è PIPEDA:**
1. ‚úÖ –°–¥–µ–ª–∞—Ç—å GPS –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º (fallback –Ω–∞ –≥–æ—Ä–æ–¥)
2. ‚úÖ Explicit consent dialog –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º –ª–æ–∫–∞—Ü–∏–∏
3. ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ä–∞–π–æ–Ω/–≥–æ—Ä–æ–¥ –ø—É–±–ª–∏—á–Ω–æ
4. ‚úÖ –•—Ä–∞–Ω–∏—Ç—å —Ä–∞–∑–º—ã—Ç—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (fuzzy location ¬±500m)
5. ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç—å –ª–æ–∫–∞—Ü–∏—é
6. ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∞–∫–∫–∞—É–Ω—Ç–∞

### **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
```sql
-- contractors table
city VARCHAR(100) NOT NULL,
province VARCHAR(50) NOT NULL,
postal_code_fsa CHAR(3), -- Only first 3 chars
neighborhood VARCHAR(100),
latitude DECIMAL(10,7), -- Fuzzy (¬±500m)
longitude DECIMAL(10,7), -- Fuzzy (¬±500m)
show_on_map BOOLEAN DEFAULT true,
offers_online_services BOOLEAN DEFAULT false,
geo_consent_given BOOLEAN DEFAULT false,
geo_consent_date TIMESTAMP
```

### **UI/UX Flow:**
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ‚Üí –≤—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
2. –ü–µ—Ä–≤—ã–π –≤–∏–∑–∏—Ç –Ω–∞ –∫–∞—Ä—Ç—É ‚Üí consent dialog
3. –û—Ç–∫–∞–∑ ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
4. –í –ø—Ä–æ—Ñ–∏–ª–µ ‚Üí –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ª–æ–∫–∞—Ü–∏–∏

---

–•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã —è —Å–æ–∑–¥–∞–ª –ø–æ–ª–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤ —Ñ–∞–π–ª–µ `/docs/api/geolocation.md` –Ω–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π?