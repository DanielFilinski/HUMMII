---
alwaysApply: false
---
# Language & Communication Rules

## Language Rules

| Context | Language | Examples |
|---------|----------|----------|
| **Code** | English | Variables, functions, classes, code comments |
| **Documentation** | Russian | `.md`, `.txt`, plans, specifications |
| **Chat/Communication** | Russian | All messages with user, questions, answers |
| **Internet Search** | 2025 data | Always search for fresh information |

## Communication Rules

### Before Every Command

**MANDATORY:**
- Describe what the command will do
- Indicate what will be affected/changed
- Warn about potential risks if any

**Example:**
```bash
# ❌ BAD
docker compose down -v

# ✅ GOOD
# Команда остановит все Docker контейнеры и УДАЛИТ все volumes (включая базу данных)
# Затронуто: PostgreSQL, Redis, все данные будут потеряны
# Используйте только если уверены!
docker compose down -v
```

## Code Quality & Security Standards

Always apply the following best practices when writing, reviewing, or suggesting code:

### Security
- Never store sensitive data (passwords, API keys, tokens) in plain text or client-side code
- Always validate and sanitize user input on both client and server side
- Use parameterized queries to prevent SQL injection
- Implement proper authentication and authorization checks
- Use HTTPS only for all communications
- Follow OWASP Top 10 security guidelines
- Ensure GDPR/PIPEDA compliance for data handling in Canada
- Implement proper error handling without exposing sensitive information
- Use secure session management and CSRF protection
- Apply principle of least privilege for all access controls

### Performance
- Optimize database queries (use indexes, avoid N+1 queries)
- Implement caching strategies where appropriate
- Use lazy loading and code splitting for frontend
- Minimize bundle sizes and optimize assets
- Use efficient data structures and algorithms
- Implement pagination for large data sets
- Profile and monitor performance bottlenecks
- Use async/await properly to avoid blocking operations

### Code Quality
- Follow DRY (Don't Repeat Yourself) principle
- Write clean, readable, and maintainable code
- Use meaningful variable and function names
- Implement proper error handling and logging
- Write modular, reusable components
- Follow SOLID principles
- Add comprehensive comments for complex logic
- Ensure type safety (TypeScript strict mode)
- Follow consistent code formatting and style guides
- Write unit tests for critical functionality

## Documentation Rules

**NEVER create separate documentation files for routine tasks.**

Instead, update existing tracking files:

### For Backend Tasks:
- **`docs/plans/backend/tasks/COMPLETED.md`** - Add completed task with brief description
- **`docs/plans/backend/tasks/TASKS_ANALYSIS.md`** - Update progress percentage and status

### When to Write Separate Documentation:
Only create new documentation files for:
1. **Major architecture changes** (new microservices, significant refactoring)
2. **New major features** (entirely new modules, payment systems, etc.)
3. **API documentation** (OpenAPI/Swagger specs)
4. **Deployment guides** (new infrastructure setup)

### Task Completion Format:
At the end of each task, provide:
1. **Commit message** (conventional commits format)
2. **Update to COMPLETED.md** (brief entry)

**Commit message format (KEEP IT CONCISE):**
```
type(scope): brief description (max 72 chars)

- Key change 1
- Key change 2  
- Key change 3 (max 5-7 bullets total)
```

**Rules:**
- Subject line: Max 72 characters
- Body: Max 5-7 bullet points (KEY changes only)
- Total length: 10-15 lines MAX
- Omit: File lists, dependency info, testing details

**Example:**
```markdown
## Updated in COMPLETED.md

Phase 2: User Management Module — 35%
✅ File upload система (S3 интеграция для аватаров)
  - Implemented multipart/form-data upload
  - S3 bucket configuration with proper permissions
  - Image optimization (resize, compress)
  - Virus scanning integration
```

---

**Note:** For detailed rules, see:
- `core-critical.mdc` - Critical TypeScript and code quality rules
- `core-security.mdc` - Security and PIPEDA compliance details